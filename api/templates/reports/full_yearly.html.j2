<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Yearly Horoscope {{ vm.header.year }}</title>
  <link rel="stylesheet" href="{{ css_href }}">
  <style>:root { --brand: {{ (branding.primary_hex or '#4A3AFF')|tojson|safe }}; }</style>
</head>
<body>
<span style="display:none; string-set: doc_title content('Yearly Horoscope {{ vm.header.year }}');"></span>

<div class="header">
  <div class="brandrow">
    {% if branding.logo_url %}<img src="{{ branding.logo_url }}" alt="logo">{% else %}
    <div style="width:40px;height:40px;border-radius:8px;background:var(--brand)"></div>{% endif %}
    <div>
      <div class="brand-title">Personal Yearly Horoscope — {{ vm.header.year }}</div>
      <div class="meta">
        {% if vm.header.name %}<span class="badge">{{ vm.header.name }}</span>{% endif %}
        <span class="badge">{{ vm.header.system|capitalize }}</span>
        <span class="badge">Zodiac: {{ vm.header.zodiac|capitalize }}</span>
        {% if vm.header.ayanamsha %}<span class="badge">Ayanamsha: {{ vm.header.ayanamsha }}</span>{% endif %}
        {% if vm.header.place_label %}<span class="badge">{{ vm.header.place_label }}</span>{% endif %}
      </div>
    </div>
  </div>
</div>

<div class="card">
  <h2>Year Overview</h2>
  <div class="grid-2">
    <div>
      <h3>Key Themes</h3>
      <ul style="margin:6px 0 0 18px">{% for t in vm.overview.key_themes %}<li>{{ t }}</li>{% endfor %}</ul>
    </div>
    <div>
      <h3>Domain Summary</h3>
      {% for k,v in vm.overview.domains_summary.items() %}
        <p><b>{{ k|capitalize }}:</b> {{ v }}</p>
      {% endfor %}
      <p class="small">Totals — Supportive: {{ vm.overview.totals.supportive }}, Challenging: {{ vm.overview.totals.challenging }}, Transformational: {{ vm.overview.totals.transformational }}</p>
    </div>
  </div>
</div>

<div class="card" style="margin-top:10px;">
  <h2>Key Dates</h2>
  <table class="table-zebra">
    <thead><tr><th>Date</th><th>Event</th><th>Domains</th></tr></thead>
    <tbody>
      {% for d in vm.key_dates %}
        <tr><td>{{ d.date }}</td><td>{{ d.label }}</td><td>{{ d.domains|join(", ") }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if vm.vedic_extras %}
  <div class="card" style="margin-top:10px;">
    <h2>Vedic Time Periods</h2>
    <table class="table-zebra">
      <thead><tr><th>Level</th><th>Lord</th><th>Start</th><th>End</th></tr></thead>
      <tbody>{% for p in vm.vedic_extras.active_periods %}<tr><td>{{ p.level }}</td><td>{{ p.lord }}</td><td>{{ p.start }}</td><td>{{ p.end }}</td></tr>{% endfor %}</tbody>
    </table>
  </div>
{% endif %}

<!-- Monthly blocks -->
{% for month, block in vm.months.items() %}
  <div class="card" style="margin-top:10px;">
    <h2>{{ month }}</h2>
    <div class="callout {% if block.tone=='supportive' %}{% elif block.tone=='testing' %}warn{% else %}muted{% endif %}">
      <b>Tone:</b> {{ block.tone|capitalize }} — {{ block.summary }}
    </div>

    <h3 style="margin-top:8px">Top Events</h3>
    <table class="table-zebra">
      <thead><tr><th>Event</th><th>Peak</th><th>Domains</th><th>Severity</th></tr></thead>
      <tbody>
        {% for ev in block.top_events %}
          <tr>
            <td>{{ ev.title }}</td>
            <td>{{ ev.peak_date or ev.date }}</td>
            <td>{{ ev.domains|join(", ") }}</td>
            <td>{{ ev.severity|capitalize }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if block.calendar and block.calendar|length>0 %}
      <h3 style="margin-top:8px">Calendar Highlights</h3>
      <table class="table-zebra">
        <thead><tr><th>Date</th><th>Label</th><th>Domains</th></tr></thead>
        <tbody>{% for cd in block.calendar %}<tr><td>{{ cd.date }}</td><td>{{ cd.label }}</td><td>{{ cd.domains|join(", ") }}</td></tr>{% endfor %}</tbody>
      </table>
    {% endif %}
  </div>
{% endfor %}

<div class="footer-note small">Generated by wh-ephemeris • Personal Yearly Horoscope {{ vm.header.year }}</div>
</body></html>
